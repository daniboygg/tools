<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chord Diagram Maker</title>
  <style>
    :root {
      /* Colors */
      --color-bg-primary: #1a1a1a;
      --color-bg-secondary: #252525;
      --color-bg-input: #333;
      --color-bg-button: #444;
      --color-bg-button-hover: #555;
      --color-text-primary: #eee;
      --color-text-secondary: #888;
      --color-text-muted: #666;
      --color-border: #444;
      --color-accent: #e85d04;
      --color-accent-hover: #dc2f02;
      --color-canvas: #fff;
      --color-canvas-text: #000;

      /* Spacing */
      --spacing-xs: 5px;
      --spacing-sm: 10px;
      --spacing-md: 15px;
      --spacing-lg: 20px;
      --spacing-xl: 30px;

      /* Sizing */
      --border-radius: 4px;
      --border-radius-sm: 3px;
      --border-radius-lg: 8px;
      --input-padding: 8px;
      --button-padding: 12px 24px;
      --panel-padding: 20px;

      /* Typography */
      --font-family: system-ui, -apple-system, sans-serif;
      --font-size-sm: 12px;
      --font-size-md: 14px;
      --font-size-lg: 18px;
      --font-size-xl: 22px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: var(--font-family);
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      padding: var(--spacing-lg);
      display: flex;
      gap: var(--spacing-xl);
      min-height: 100vh;
    }
    .panel {
      background: var(--color-bg-secondary);
      border-radius: var(--border-radius-lg);
      padding: var(--panel-padding);
    }
    .controls {
      width: 320px;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }
    h2 {
      font-size: var(--font-size-md);
      color: var(--color-text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: var(--spacing-sm);
    }
    .string-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    .string-row label {
      width: 20px;
      text-align: center;
      font-weight: bold;
    }
    .string-row select, .string-row input {
      flex: 1;
      padding: var(--input-padding);
      background: var(--color-bg-input);
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      border-radius: var(--border-radius);
    }
    .string-row input[type="text"] {
      width: 60px;
      flex: none;
    }
    .preview {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--spacing-lg);
    }
    #chordCanvas {
      background: var(--color-canvas);
      border-radius: var(--border-radius);
      width: 512px;
      height: 256px;
    }
    .chord-name-input {
      width: 100%;
      padding: 12px;
      font-size: var(--font-size-lg);
      background: var(--color-bg-input);
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      border-radius: var(--border-radius);
      text-align: center;
    }
    .btn {
      padding: var(--button-padding);
      font-size: var(--font-size-md);
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: bold;
    }
    .btn-primary {
      background: var(--color-accent);
      color: white;
    }
    .btn-primary:hover {
      background: var(--color-accent-hover);
    }
    .btn-secondary {
      background: var(--color-bg-button);
      color: var(--color-text-primary);
    }
    .btn-secondary:hover {
      background: var(--color-bg-button-hover);
    }
    .buttons {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }
    .fret-config {
      display: flex;
      gap: var(--spacing-sm);
      align-items: center;
    }
    .fret-config input {
      width: 60px;
      padding: var(--input-padding);
      background: var(--color-bg-input);
      border: 1px solid var(--color-border);
      color: var(--color-text-primary);
      border-radius: var(--border-radius);
    }
    .interval-presets {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-xs);
    }
    .interval-presets button {
      padding: 4px 8px;
      font-size: var(--font-size-sm);
      background: var(--color-bg-button);
      border: none;
      color: var(--color-text-primary);
      border-radius: var(--border-radius-sm);
      cursor: pointer;
    }
    .interval-presets button:hover {
      background: var(--color-bg-button-hover);
    }
    .help {
      font-size: var(--font-size-sm);
      color: var(--color-text-muted);
      margin-top: var(--spacing-xs);
    }
  </style>
</head>
<body>
  <div class="panel controls">
    <div>
      <h2>Chord Name</h2>
      <input type="text" class="chord-name-input" id="chordName" placeholder="e.g. Cdim7" value="">
    </div>

    <div>
      <h2>Fret Range</h2>
      <div class="fret-config">
        <label>Start:</label>
        <input type="number" id="startFret" value="1" min="0" max="20">
        <label>Frets:</label>
        <input type="number" id="numFrets" value="4" min="3" max="8">
      </div>
    </div>

    <div>
      <h2>Strings (high e to low E)</h2>
      <div id="stringInputs"></div>
      <p class="help">Fret: 0=open, X=muted, 1-20=fret number</p>
    </div>

    <div>
      <h2>Quick Intervals</h2>
      <div class="interval-presets">
        <button onclick="setInterval('1')">1</button>
        <button onclick="setInterval('2♭')">2♭</button>
        <button onclick="setInterval('2')">2</button>
        <button onclick="setInterval('3♭')">3♭</button>
        <button onclick="setInterval('3')">3</button>
        <button onclick="setInterval('4')">4</button>
        <button onclick="setInterval('5♭')">5♭</button>
        <button onclick="setInterval('5')">5</button>
        <button onclick="setInterval('5♯')">5♯</button>
        <button onclick="setInterval('6')">6</button>
        <button onclick="setInterval('7♭')">7♭</button>
        <button onclick="setInterval('7')">7</button>
      </div>
      <p class="help">Click to change interval to last focused string</p>
    </div>

    <div class="buttons">
      <button class="btn btn-primary" onclick="downloadPNG()">Download PNG</button>
      <button class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
      <button class="btn btn-secondary" onclick="clearAll()">Clear</button>
    </div>
  </div>

  <div class="panel preview">
    <h2>Preview</h2>
    <canvas id="chordCanvas" width="512" height="256"></canvas>
  </div>

  <script>
    const canvas = document.getElementById('chordCanvas');
    const ctx = canvas.getContext('2d');

    // String data: [fret, interval] - fret can be 'x', '0', or number
    // Order: high e, B, G, D, A, low E (top to bottom visually - matching how we draw)
    let strings = [
      { fret: 'x', interval: '' },  // high e (top)
      { fret: '3', interval: '3♭' }, // B
      { fret: '2', interval: '7♭' }, // G
      { fret: '3', interval: '5♭' }, // D
      { fret: '2', interval: '1' },  // A
      { fret: 'x', interval: '' }   // low E (bottom)
    ];

    let lastFocusedInterval = null;

    function createStringInputs() {
      const container = document.getElementById('stringInputs');
      const stringNames = ['e', 'B', 'G', 'D', 'A', 'E'];

      container.innerHTML = strings.map((s, i) => `
        <div class="string-row">
          <label>${stringNames[i]}</label>
          <select onchange="updateString(${i}, 'fret', this.value)">
            <option value="x" ${s.fret === 'x' ? 'selected' : ''}>X</option>
            <option value="0" ${s.fret === '0' ? 'selected' : ''}>Open</option>
            ${[...Array(8)].map((_, f) =>
              `<option value="${f+1}" ${s.fret === String(f+1) ? 'selected' : ''}>${f+1}</option>`
            ).join('')}
          </select>
          <input type="text"
                 placeholder="interval"
                 value="${s.interval}"
                 onfocus="lastFocusedInterval = this"
                 oninput="updateString(${i}, 'interval', this.value)">
        </div>
      `).join('');
    }

    function updateString(index, prop, value) {
      strings[index][prop] = value;
      draw();
    }

    function setInterval(interval) {
      if (lastFocusedInterval) {
        lastFocusedInterval.value = interval;
        const index = [...document.querySelectorAll('.string-row input[type="text"]')].indexOf(lastFocusedInterval);
        if (index !== -1) {
          strings[index].interval = interval;
          draw();
        }
      }
      navigator.clipboard.writeText(interval);
    }

    function draw() {
      const startFret = parseInt(document.getElementById('startFret').value) || 1;
      const numFrets = parseInt(document.getElementById('numFrets').value) || 5;
      const chordName = document.getElementById('chordName').value;

      const canvasWidth = 512;
      const canvasHeight = 256;
      const leftPadding = 60;
      const rightPadding = 40;
      const topPadding = 40;
      const bottomPadding = 20;
      const width = canvasWidth - leftPadding - rightPadding;
      const height = canvasHeight - topPadding - bottomPadding;
      const stringSpacing = height / 5;
      const fretSpacing = width / numFrets;

      // Clear
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, canvasWidth, canvasHeight);

      // Chord name
      if (chordName) {
        ctx.fillStyle = '#000';
        ctx.font = 'bold 22px system-ui';
        ctx.textAlign = 'center';
        ctx.fillText(chordName, canvasWidth / 2, 26);
      }

      // Starting fret indicator
      if (startFret > 1) {
        ctx.fillStyle = '#000';
        ctx.font = '14px system-ui';
        ctx.textAlign = 'center';
        ctx.fillText(`${startFret}fr`, leftPadding + fretSpacing / 2, topPadding - 10);
      }

      // Draw strings (horizontal lines)
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 1.5;
      for (let i = 0; i < 6; i++) {
        const y = topPadding + i * stringSpacing;
        ctx.beginPath();
        ctx.moveTo(leftPadding, y);
        ctx.lineTo(leftPadding + width, y);
        ctx.stroke();
      }

      // Draw nut if starting from fret 1 (draw before frets so frets overlay)
      if (startFret <= 1) {
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.moveTo(leftPadding, topPadding - 1);
        ctx.lineTo(leftPadding, topPadding + height + 1);
        ctx.stroke();
      }

      // Draw frets (vertical lines)
      ctx.lineWidth = 2;
      for (let i = 0; i <= numFrets; i++) {
        const x = leftPadding + i * fretSpacing;
        ctx.beginPath();
        ctx.moveTo(x, topPadding);
        ctx.lineTo(x, topPadding + height);
        ctx.stroke();
      }

      // Draw notes and markers
      strings.forEach((s, i) => {
        // Direct mapping: array index matches visual position (top to bottom)
        const y = topPadding + i * stringSpacing;

        if (s.fret === 'x') {
          // X marker on the left
          ctx.font = 'bold 18px system-ui';
          ctx.fillStyle = '#000';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          ctx.fillText('✕', leftPadding - 25, y);
        } else if (s.fret === '0') {
          // Open string - circle on the left
          ctx.beginPath();
          ctx.arc(leftPadding - 25, y, 8, 0, Math.PI * 2);
          ctx.strokeStyle = '#000';
          ctx.lineWidth = 2;
          ctx.stroke();
        } else {
          const fretNum = parseInt(s.fret);
          const relativeFret = fretNum - startFret + 1;

          if (relativeFret >= 1 && relativeFret <= numFrets) {
            const x = leftPadding + (relativeFret - 0.5) * fretSpacing;

            // Draw circle
            ctx.beginPath();
            ctx.arc(x, y, 20, 0, Math.PI * 2);
            ctx.fillStyle = '#e85d04';
            ctx.fill();

            // Draw interval text
            if (s.interval) {
              ctx.fillStyle = '#fff';
              ctx.font = 'bold 22px system-ui';
              ctx.textAlign = 'center';
              ctx.textBaseline = 'middle';
              // Adjust vertical position slightly for better optical centering
              ctx.fillText(s.interval, x, y + 1);
            }
          }
        }
      });

      ctx.textBaseline = 'alphabetic';
    }

    function downloadPNG() {
      const link = document.createElement('a');
      const name = document.getElementById('chordName').value || 'chord';
      link.download = `${name}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    }

    async function copyToClipboard() {
      try {
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        await navigator.clipboard.write([
          new ClipboardItem({ 'image/png': blob })
        ]);
        alert('Copied to clipboard!');
      } catch (err) {
        console.error('Failed to copy:', err);
        alert('Failed to copy. Try downloading instead.');
      }
    }

    function clearAll() {
      strings = strings.map(() => ({ fret: 'x', interval: '' }));
      document.getElementById('chordName').value = '';
      createStringInputs();
      draw();
    }

    // Event listeners
    document.getElementById('startFret').addEventListener('input', draw);
    document.getElementById('numFrets').addEventListener('input', draw);
    document.getElementById('chordName').addEventListener('input', draw);

    // Initialize on page load
    window.addEventListener('load', function() {
      createStringInputs();
      draw();
    });

    // Also initialize immediately for faster rendering
    createStringInputs();
    draw();
  </script>
</body>
</html>
